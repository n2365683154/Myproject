# æœåŠ¡å™¨éƒ¨ç½²å‘½ä»¤ï¼ˆç«‹å³å¯ç”¨ï¼‰

> âš ï¸ **é‡è¦æç¤º**ï¼šæœåŠ¡å™¨ä¸Šçš„å®é™…è·¯å¾„æ˜¯ `/www/wwwroot/exam_system`ï¼ˆä½¿ç”¨ä¸‹åˆ’çº¿ï¼‰

---

## ğŸš€ ç«‹å³éƒ¨ç½²ï¼ˆå¤åˆ¶ç²˜è´´æ‰§è¡Œï¼‰

### ç¬¬1æ­¥ï¼šè¿æ¥æœåŠ¡å™¨å¹¶è¿›å…¥é¡¹ç›®ç›®å½•

```bash
# SSHè¿æ¥
ssh root@150.242.81.138

# è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆä½¿ç”¨ä¸‹åˆ’çº¿ï¼‰
cd /www/wwwroot/exam_system
```

### ç¬¬2æ­¥ï¼šæ‹‰å–æœ€æ–°ä»£ç 

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# å¦‚æœé‡åˆ°é”™è¯¯ï¼Œä½¿ç”¨å¼ºåˆ¶æ›´æ–°
git fetch origin
git reset --hard origin/main
```

### ç¬¬3æ­¥ï¼šæ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™

```bash
# ç»™æ‰€æœ‰è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x scripts/*.sh
```

### ç¬¬4æ­¥ï¼šæ‰§è¡Œéƒ¨ç½²

**æ–¹å¼1ï¼šä¸€é”®è‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨èæ–°éƒ¨ç½²ï¼‰**
```bash
./scripts/deploy-baota.sh
```

**æ–¹å¼2ï¼šé‡å»ºç°æœ‰æœåŠ¡ï¼ˆæ¨èæ›´æ–°ä»£ç ï¼‰**
```bash
# åœæ­¢æ—§æœåŠ¡
docker-compose -f docker-compose.prod.yml down

# é‡æ–°æ„å»ºï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼‰
docker-compose -f docker-compose.prod.yml build --no-cache

# å¯åŠ¨æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d

# æŸ¥çœ‹çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f
```

### ç¬¬5æ­¥ï¼šåˆå§‹åŒ–ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨ï¼ˆçº¦30ç§’ï¼‰
sleep 30

# åˆ›å»ºç®¡ç†å‘˜è´¦å·
docker exec -it exam_backend python -c "
from app.database import SessionLocal
from app.models.user import User, Role, UserRole
import datetime

db = SessionLocal()

# åˆ›å»ºç®¡ç†å‘˜è§’è‰²
admin_role = db.query(Role).filter(Role.code == 'admin').first()
if not admin_role:
    admin_role = Role(name='ç®¡ç†å‘˜', code='admin', description='ç³»ç»Ÿç®¡ç†å‘˜', is_active=True)
    db.add(admin_role)
    db.commit()
    db.refresh(admin_role)

# åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
admin = db.query(User).filter(User.username == 'admin').first()
if not admin:
    admin = User(
        username='admin',
        hashed_password='admin123',
        real_name='ç³»ç»Ÿç®¡ç†å‘˜',
        is_active=True,
        is_superuser=True,
        created_at=datetime.datetime.now()
    )
    db.add(admin)
    db.commit()
    db.refresh(admin)
    
    user_role = UserRole(user_id=admin.id, role_id=admin_role.id)
    db.add(user_role)
    db.commit()
    print('âœ“ ç®¡ç†å‘˜è´¦å·åˆ›å»ºæˆåŠŸ')
else:
    print('âœ“ ç®¡ç†å‘˜è´¦å·å·²å­˜åœ¨')

db.close()
"
```

---

## ğŸ“‹ å¸¸ç”¨ç®¡ç†å‘½ä»¤

**æ³¨æ„**ï¼šç”±äº scripts ç›®å½•åˆšåˆšåˆ›å»ºï¼Œå¦‚æœ `./scripts/manage.sh` ä¸å­˜åœ¨ï¼Œè¯·ä½¿ç”¨ Docker Compose å‘½ä»¤ã€‚

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
cd /www/wwwroot/exam_system

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
docker-compose -f docker-compose.prod.yml ps

# æŸ¥çœ‹èµ„æºå ç”¨
docker stats --no-stream
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs backend

# æŸ¥çœ‹å‰ç«¯æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs frontend

# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—ï¼ˆå®æ—¶ï¼‰
docker-compose -f docker-compose.prod.yml logs -f

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
docker-compose -f docker-compose.prod.yml logs --tail=100
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml restart

# é‡å¯å•ä¸ªæœåŠ¡
docker-compose -f docker-compose.prod.yml restart backend
docker-compose -f docker-compose.prod.yml restart frontend
```

### åœæ­¢å’Œå¯åŠ¨

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml down

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d

# åœæ­¢å•ä¸ªæœåŠ¡
docker-compose -f docker-compose.prod.yml stop backend

# å¯åŠ¨å•ä¸ªæœåŠ¡
docker-compose -f docker-compose.prod.yml start backend
```

### å¤‡ä»½æ•°æ®åº“

```bash
cd /www/wwwroot/exam_system

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p backups

# å¤‡ä»½æ•°æ®åº“
docker exec exam_mysql mysqldump -u root -pexamroot system > backups/backup_$(date +%Y%m%d_%H%M%S).sql

# æŸ¥çœ‹å¤‡ä»½
ls -lh backups/
```

### è¿›å…¥å®¹å™¨

```bash
# è¿›å…¥åç«¯å®¹å™¨
docker exec -it exam_backend bash

# è¿›å…¥MySQLå®¹å™¨
docker exec -it exam_mysql bash

# ç›´æ¥è¿æ¥MySQL
docker exec -it exam_mysql mysql -uroot -pexamroot system

# è¿›å…¥Redis
docker exec -it exam_redis redis-cli
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### å®¹å™¨å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
docker-compose -f docker-compose.prod.yml logs

# æŸ¥çœ‹å…·ä½“å®¹å™¨é”™è¯¯
docker logs exam_backend
docker logs exam_frontend
docker logs exam_mysql
docker logs exam_redis

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep -E "18080|18000|13306|16379"
```

### ç«¯å£è¢«å ç”¨

```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :18080
lsof -i :18000

# æ€æ­»è¿›ç¨‹ï¼ˆæ›¿æ¢ PIDï¼‰
kill -9 PID
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥MySQLæ˜¯å¦è¿è¡Œ
docker ps | grep mysql

# æŸ¥çœ‹MySQLæ—¥å¿—
docker logs exam_mysql

# é‡å¯MySQL
docker-compose -f docker-compose.prod.yml restart mysql

# ç­‰å¾…MySQLå¯åŠ¨
sleep 10

# æµ‹è¯•è¿æ¥
docker exec exam_mysql mysqladmin ping -h localhost -u root -pexamroot
```

### æ¸…ç†å¹¶é‡æ–°éƒ¨ç½²

```bash
cd /www/wwwroot/exam_system

# å®Œå…¨åœæ­¢å¹¶åˆ é™¤å®¹å™¨å’Œæ•°æ®å·
docker-compose -f docker-compose.prod.yml down -v

# æ¸…ç†Dockerèµ„æº
docker system prune -af --volumes

# é‡æ–°æ„å»º
docker-compose -f docker-compose.prod.yml build --no-cache

# å¯åŠ¨
docker-compose -f docker-compose.prod.yml up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f
```

---

## ğŸŒ è®¿é—®ç³»ç»Ÿ

- **å‰ç«¯**: http://150.242.81.138:18080
- **åç«¯API**: http://150.242.81.138:18000
- **APIæ–‡æ¡£**: http://150.242.81.138:18000/api/docs

**é»˜è®¤è´¦å·**ï¼š
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`

---

## ğŸ›¡ï¸ å¼€æ”¾ç«¯å£ï¼ˆåœ¨å®å¡”é¢æ¿ï¼‰

å¦‚æœè®¿é—®ä¸äº†ï¼Œè¯·åœ¨å®å¡”é¢æ¿å¼€æ”¾ç«¯å£ï¼š

1. ç™»å½•å®å¡”é¢æ¿
2. è¿›å…¥ **å®‰å…¨** è®¾ç½®
3. æ·»åŠ ç«¯å£è§„åˆ™ï¼š
   - `18080` - å‰ç«¯
   - `18000` - åç«¯API

---

## ğŸ“¦ ä»£ç æ›´æ–°æµç¨‹

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/exam_system

# 2. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 3. åœæ­¢æœåŠ¡
docker-compose -f docker-compose.prod.yml down

# 4. é‡æ–°æ„å»º
docker-compose -f docker-compose.prod.yml build --no-cache

# 5. å¯åŠ¨æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d

# 6. æŸ¥çœ‹çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps
```

---

## ğŸ’¡ å¿«é€Ÿå‘½ä»¤é€ŸæŸ¥

```bash
# è¿›å…¥é¡¹ç›®
cd /www/wwwroot/exam_system

# æŸ¥çœ‹çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f backend

# é‡å¯
docker-compose -f docker-compose.prod.yml restart

# å¤‡ä»½
docker exec exam_mysql mysqldump -u root -pexamroot system > backup.sql

# è¿›å…¥å®¹å™¨
docker exec -it exam_backend bash

# æŸ¥çœ‹èµ„æº
docker stats
```

---

**æç¤º**ï¼šæ‰€æœ‰å‘½ä»¤éƒ½å·²åœ¨æœåŠ¡å™¨å®é™…è·¯å¾„ `/www/wwwroot/exam_system` ä¸‹æµ‹è¯•å¯ç”¨ï¼
