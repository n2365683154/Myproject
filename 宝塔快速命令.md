# å®å¡”é¢æ¿å¿«é€Ÿå‘½ä»¤å‚è€ƒ

## ğŸš€ ä¸€é”®éƒ¨ç½²

```bash
# SSH è¿æ¥æœåŠ¡å™¨
ssh root@150.242.81.138

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/exam_system

# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x scripts/*.sh

# æ‰§è¡Œä¸€é”®éƒ¨ç½²
./scripts/deploy-baota.sh
```

---

## ğŸ“‹ æ—¥å¸¸ ç®¡ç† å‘½ä»¤

### å®¹å™¨ç®¡ç†

```bash
cd /www/wwwroot/exam_system

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./scripts/manage.sh start

# åœæ­¢æ‰€æœ‰æœåŠ¡
./scripts/manage.sh stop

# é‡å¯æ‰€æœ‰æœåŠ¡
./scripts/manage.sh restart

# é‡å»ºæœåŠ¡ï¼ˆä»£ç æ›´æ–°åï¼‰
./scripts/manage.sh rebuild

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./scripts/manage.sh status
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
./scripts/manage.sh logs backend

# æŸ¥çœ‹å‰ç«¯æ—¥å¿—
./scripts/manage.sh logs frontend

# æŸ¥çœ‹MySQLæ—¥å¿—
./scripts/manage.sh logs mysql

# æŸ¥çœ‹Redisæ—¥å¿—
./scripts/manage.sh logs redis

# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs
```

### æ•°æ®åº“ç®¡ç†

```bash
# å¤‡ä»½æ•°æ®åº“
./scripts/manage.sh backup

# è¿›å…¥MySQLå®¹å™¨
docker exec -it exam_mysql bash

# è¿æ¥MySQL
docker exec -it exam_mysql mysql -uroot -pexamroot system

# å¯¼å‡ºæ•°æ®åº“
docker exec exam_mysql mysqldump -u root -pexamroot system > backup.sql

# å¯¼å…¥æ•°æ®åº“
docker exec -i exam_mysql mysql -u root -pexamroot system < backup.sql
```

### ç³»ç»Ÿç»´æŠ¤

```bash
# åˆ›å»ºç®¡ç†å‘˜è´¦å·
./scripts/manage.sh admin

# ä¿®å¤éªŒè¯é€»è¾‘
./scripts/manage.sh fix-auth

# æŸ¥çœ‹å®¹å™¨èµ„æºå ç”¨
docker stats

# æ¸…ç†æ— ç”¨çš„Dockerèµ„æº
docker system prune -af
```

---

## ğŸ”§ å®å¡”é¢æ¿æ“ä½œ

### åœ¨é¢æ¿ä¸Šç®¡ç†å®¹å™¨

1. ç™»å½•å®å¡”é¢æ¿
2. è¿›å…¥ **Docker** â†’ **å®¹å™¨åˆ—è¡¨**
3. å¯ä»¥çœ‹åˆ°4ä¸ªå®¹å™¨ï¼š
   - `exam_frontend` - å‰ç«¯æœåŠ¡
   - `exam_backend` - åç«¯æœåŠ¡
   - `exam_mysql` - æ•°æ®åº“
   - `exam_redis` - ç¼“å­˜

**æ“ä½œ**ï¼š
- ç‚¹å‡» **å¯åŠ¨/åœæ­¢** æŒ‰é’®æ§åˆ¶å®¹å™¨
- ç‚¹å‡» **æ—¥å¿—** æŸ¥çœ‹è¿è¡Œæ—¥å¿—
- ç‚¹å‡» **ç»ˆç«¯** è¿›å…¥å®¹å™¨å‘½ä»¤è¡Œ
- ç‚¹å‡» **è¯¦æƒ…** æŸ¥çœ‹å®¹å™¨é…ç½®

### å¼€æ”¾ç«¯å£

1. å®å¡”é¢æ¿ â†’ **å®‰å…¨**
2. ç‚¹å‡» **æ·»åŠ è§„åˆ™**
3. æ·»åŠ ä»¥ä¸‹ç«¯å£ï¼š
   ```
   18080  # å‰ç«¯
   18000  # åç«¯API
   ```

### é…ç½®åå‘ä»£ç†

1. å®å¡”é¢æ¿ â†’ **ç½‘ç«™** â†’ **æ·»åŠ ç«™ç‚¹**
2. è¾“å…¥åŸŸåï¼ˆå¦‚ `exam.yourdomain.com`ï¼‰
3. ç‚¹å‡»ç«™ç‚¹ â†’ **è®¾ç½®** â†’ **åå‘ä»£ç†**
4. æ·»åŠ ä»£ç†ï¼š
   - ä»£ç†åç§°ï¼šè€ƒè¯•ç³»ç»Ÿ
   - ç›®æ ‡URLï¼š`http://127.0.0.1:18080`
   - å‘é€åŸŸåï¼š`$host`
   - å¯ç”¨ä»£ç†

### è®¾ç½®è‡ªåŠ¨å¤‡ä»½

1. å®å¡”é¢æ¿ â†’ **è®¡åˆ’ä»»åŠ¡**
2. ä»»åŠ¡ç±»å‹ï¼š**Shellè„šæœ¬**
3. ä»»åŠ¡åç§°ï¼š**è€ƒè¯•ç³»ç»Ÿå¤‡ä»½**
4. æ‰§è¡Œå‘¨æœŸï¼š**æ¯å¤© 3:00**
5. è„šæœ¬å†…å®¹ï¼š
   ```bash
   #!/bin/bash
   cd /www/wwwroot/exam_system
   ./scripts/manage.sh backup
   find /www/wwwroot/exam_system/backups -name "*.sql" -mtime +7 -delete
   ```

---

## ğŸ” æ•…éšœæ’æŸ¥å‘½ä»¤

### æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
docker ps -a

# æŸ¥çœ‹å®¹å™¨è¯¦ç»†çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# æŸ¥çœ‹å®¹å™¨èµ„æºå ç”¨
docker stats --no-stream
```

### æ£€æŸ¥ç«¯å£

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tulpn | grep -E "18080|18000|13306|16379"

# æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™
firewall-cmd --list-ports

# å¼€æ”¾ç«¯å£
firewall-cmd --add-port=18080/tcp --permanent
firewall-cmd --add-port=18000/tcp --permanent
firewall-cmd --reload
```

### æ£€æŸ¥æ—¥å¿—

```bash
# æŸ¥çœ‹åç«¯é”™è¯¯æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs backend | grep -i error

# æŸ¥çœ‹MySQLæ—¥å¿—
docker logs exam_mysql --tail 50

# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
tail -f /var/log/messages
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯å•ä¸ªå®¹å™¨
docker restart exam_backend

# é‡å¯DockeræœåŠ¡
systemctl restart docker

# é‡å¯æ‰€æœ‰å®¹å™¨
./scripts/manage.sh restart
```

---

## ğŸ“¦ ä»£ç æ›´æ–°æµç¨‹

### ä»Gitæ›´æ–°

```bash
cd /www/wwwroot/exam_system

# æŸ¥çœ‹å½“å‰çŠ¶æ€
git status

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# å¦‚æœæœ‰å†²çªï¼Œå¼ºåˆ¶æ›´æ–°
git fetch origin
git reset --hard origin/main

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
./scripts/manage.sh rebuild
```

### æ‰‹åŠ¨ä¸Šä¼ æ›´æ–°

1. ä½¿ç”¨å®å¡”é¢æ¿ â†’ **æ–‡ä»¶**
2. ä¸Šä¼ æ–°æ–‡ä»¶åˆ°é¡¹ç›®ç›®å½•
3. åœ¨SSHä¸­æ‰§è¡Œï¼š
   ```bash
   cd /www/wwwroot/exam_system
   ./scripts/manage.sh rebuild
   ```

---

## ğŸ” å®‰å…¨ç»´æŠ¤

### ä¿®æ”¹æ•°æ®åº“å¯†ç 

```bash
# è¿›å…¥MySQLå®¹å™¨
docker exec -it exam_mysql mysql -uroot -pexamroot

# ä¿®æ”¹å¯†ç 
ALTER USER 'root'@'%' IDENTIFIED BY 'æ–°å¯†ç ';
FLUSH PRIVILEGES;
exit

# åŒæ­¥ä¿®æ”¹ .env æ–‡ä»¶
nano .env
# å°† MYSQL_PASSWORD æ”¹ä¸ºæ–°å¯†ç 

# é‡å¯æœåŠ¡
./scripts/manage.sh restart
```

### ä¿®æ”¹ç®¡ç†å‘˜å¯†ç 

ç™»å½•ç³»ç»Ÿååœ¨ **ä¸ªäººä¸­å¿ƒ** â†’ **ä¿®æ”¹å¯†ç **

æˆ–é€šè¿‡æ•°æ®åº“ç›´æ¥ä¿®æ”¹ï¼š

```bash
docker exec -it exam_mysql mysql -uroot -pexamroot system
UPDATE users SET hashed_password='æ–°å¯†ç æ˜æ–‡' WHERE username='admin';
```

---

## ğŸ“Š ç›‘æ§å‘½ä»¤

### æŸ¥çœ‹èµ„æºä½¿ç”¨

```bash
# CPUå’Œå†…å­˜
top

# ç£ç›˜ä½¿ç”¨
df -h

# Dockerèµ„æº
docker stats

# å®¹å™¨å ç”¨çš„ç£ç›˜ç©ºé—´
docker system df
```

### æŸ¥çœ‹è®¿é—®æ—¥å¿—

```bash
# Nginxè®¿é—®æ—¥å¿—ï¼ˆå¦‚æœé…ç½®äº†åå‘ä»£ç†ï¼‰
tail -f /www/wwwlogs/exam.yourdomain.com.log

# å®¹å™¨æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f --tail=100
```

---

## ğŸ’¡ å¸¸è§æ“ä½œå¿«é€ŸæŸ¥è¯¢

| éœ€æ±‚ | å‘½ä»¤ |
|------|------|
| å¯åŠ¨æœåŠ¡ | `./scripts/manage.sh start` |
| åœæ­¢æœåŠ¡ | `./scripts/manage.sh stop` |
| é‡å¯æœåŠ¡ | `./scripts/manage.sh restart` |
| æŸ¥çœ‹çŠ¶æ€ | `./scripts/manage.sh status` |
| æŸ¥çœ‹æ—¥å¿— | `./scripts/manage.sh logs backend` |
| å¤‡ä»½æ•°æ® | `./scripts/manage.sh backup` |
| é‡å»ºå®¹å™¨ | `./scripts/manage.sh rebuild` |
| åˆ›å»ºç®¡ç†å‘˜ | `./scripts/manage.sh admin` |
| ä¿®å¤éªŒè¯ | `./scripts/manage.sh fix-auth` |
| è¿›å…¥MySQL | `docker exec -it exam_mysql mysql -uroot -pexamroot` |
| è¿›å…¥å®¹å™¨ | `docker exec -it exam_backend bash` |
| æŸ¥çœ‹èµ„æº | `docker stats` |
| æ¸…ç†èµ„æº | `docker system prune -af` |

---

## ğŸ†˜ ç´§æ€¥æƒ…å†µå¤„ç†

### æœåŠ¡å®Œå…¨æ— æ³•è®¿é—®

```bash
# 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps -a

# 2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs

# 3. åœæ­¢æ‰€æœ‰æœåŠ¡
./scripts/manage.sh stop

# 4. æ¸…ç†å¹¶é‡å»º
docker system prune -af
./scripts/manage.sh rebuild

# 5. æ£€æŸ¥ç«¯å£å’Œé˜²ç«å¢™
netstat -tulpn | grep -E "18080|18000"
firewall-cmd --list-ports
```

### æ•°æ®åº“æŸå

```bash
# 1. åœæ­¢æœåŠ¡
./scripts/manage.sh stop

# 2. æ¢å¤æœ€è¿‘çš„å¤‡ä»½
docker-compose -f docker-compose.prod.yml up -d mysql
sleep 10
docker exec -i exam_mysql mysql -u root -pexamroot system < backups/æœ€æ–°å¤‡ä»½.sql

# 3. å¯åŠ¨å…¶ä»–æœåŠ¡
./scripts/manage.sh start
```

### ç£ç›˜ç©ºé—´ä¸è¶³

```bash
# 1. æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# 2. æ¸…ç†Dockerèµ„æº
docker system prune -af --volumes

# 3. æ¸…ç†æ—§å¤‡ä»½
find /www/wwwroot/exam_system/backups -name "*.sql" -mtime +7 -delete

# 4. æ¸…ç†å®å¡”æ—¥å¿—
rm -f /www/wwwlogs/*.log.*
```

---

**æç¤º**ï¼šå»ºè®®å°†æ­¤æ–‡æ¡£ä¿å­˜å¹¶æ‰“å°ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶å¿«é€ŸæŸ¥è¯¢ï¼
